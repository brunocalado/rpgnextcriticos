{"name":"Rolar Erro Crítico da Tabela","type":"script","author":"Ol2t8tYZADY5EZKq","img":"modules/rpgnextcriticos/images/icons/nok.svg","scope":"global","command":"//const tableName = 'Acerto Crítico';\nconst tableName = 'Erro Crítico';\nconst peculiaridades = await drawFromTable(tableName);\n\n\nasync function drawFromTable(tableName) {\n\n  let list_compendium = await game.packs.filter(p=>p.documentName=='RollTable');      \n  let inside = await list_compendium.find( p=>p.metadata.label=='RPG Next - Tabelas' ).getDocuments();      \n  const table = await inside.filter( p=>p.name==tableName )[0];          \n  \n  if (!table) {\n    ui.notifications.warn(`Table ${tableName} not found.`, {});\n    return;\n  }\n  const output = await table.roll();\n  const result = output.results[0].img;\n  await ChatMessage.create({content: `<img src=\"${result}\">`});\n  \n  const popout = new ImagePopout(result).render(true);\n  popout.shareImage();\n}","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.x6TLTSN9QpfAdSQh"}},"_id":"KeVqPuWyzyNc7HTV","ownership":{"default":0,"Ol2t8tYZADY5EZKq":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.0-alpha3","coreVersion":"10.279","createdTime":null,"modifiedTime":1661792613975,"lastModifiedBy":"RIvpcrnNsACOddfy"}}
{"name":"Rolar Acerto Crítico do Baralho","type":"script","author":"RIvpcrnNsACOddfy","img":"modules/rpgnextcriticos/images/icons/ok.svg","scope":"global","command":"const deckName = 'Acerto Crítico';\n//const deckName = 'Erro Crítico';\nconst peculiaridades = await drawFromDeck(deckName);\n\n\nasync function drawFromDeck(deckName) {\n  const deck = await game.cards.find((t) => t.name == deckName);\n  \n  if (!deck) {\n    ui.notifications.warn(`Deck ${deckName} not found.`, {});\n    return;\n  }\n\n  await deck.recall({ chatNotification: false });\n  await deck.shuffle({ chatNotification: false });  \n  \n  let cardsDrawn = deck._drawCards(1, CONST.CARD_DRAW_MODES.TOP);\n  let updates = cardsDrawn.map((v) => {\n    return {\n      _id: v.id,\n      drawn: true,\n    };\n  });\n\n  await deck.updateEmbeddedDocuments('Card', updates);\n  \n  const result = cardsDrawn[0].faces[0].img;\n  await ChatMessage.create({content: `<img src=\"${result}\">`});\n  \n  const popout = new ImagePopout(result).render(true);\n  popout.shareImage();\n\n  await deck.recall({ chatNotification: false });\n  await deck.shuffle({ chatNotification: false });  \n\n}","flags":{"core":{"sourceId":"Macro.O6viqS0xzNwe5APo"}},"ownership":{"default":0,"Ol2t8tYZADY5EZKq":3,"RIvpcrnNsACOddfy":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.286","createdTime":1661792474469,"modifiedTime":1665085616966,"lastModifiedBy":"qLJR0b13FCjucB1n"},"folder":null,"sort":0,"_id":"XyHpUcXhVeX2o2bz"}
{"name":"Rolar Erro Crítico do Baralho","type":"script","author":"RIvpcrnNsACOddfy","img":"modules/rpgnextcriticos/images/icons/nok.svg","scope":"global","command":"//const deckName = 'Acerto Crítico';\nconst deckName = 'Falha Crítica';\nconst peculiaridades = await drawFromDeck(deckName);\n\n\nasync function drawFromDeck(deckName) {\n  const deck = await game.cards.find((t) => t.name == deckName);\n  \n  if (!deck) {\n    ui.notifications.warn(`Deck ${deckName} not found.`, {});\n    return;\n  }\n  \n  await deck.recall({ chatNotification: false });\n  await deck.shuffle({ chatNotification: false });\n  \n  let cardsDrawn = deck._drawCards(1, CONST.CARD_DRAW_MODES.TOP);\n  let updates = cardsDrawn.map((v) => {\n    return {\n      _id: v.id,\n      drawn: true,\n    };\n  });\n  console.log(cardsDrawn[0].faces[0].img)\n  await deck.updateEmbeddedDocuments('Card', updates);\n  \n  const result = cardsDrawn[0].faces[0].img;\n  await ChatMessage.create({content: `<img src=\"${result}\">`});\n  \n  const popout = new ImagePopout(result).render(true);\n  popout.shareImage();\n\n  await deck.recall({ chatNotification: false });\n  await deck.shuffle({ chatNotification: false });  \n}","flags":{"core":{"sourceId":"Macro.x6TLTSN9QpfAdSQh"}},"ownership":{"default":0,"Ol2t8tYZADY5EZKq":3,"RIvpcrnNsACOddfy":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.3","coreVersion":"10.286","createdTime":1661792475996,"modifiedTime":1665085607661,"lastModifiedBy":"qLJR0b13FCjucB1n"},"folder":null,"sort":0,"_id":"hiBi3Q1ACKShfru1"}
{"name":"Rolar Acerto Crítico da Tabela","type":"script","author":"Ol2t8tYZADY5EZKq","img":"modules/rpgnextcriticos/images/icons/ok.svg","scope":"global","command":"const tableName = 'Acerto Crítico';\n//const tableName = 'Erro Crítico';\nconst peculiaridades = await drawFromTable(tableName);\n\n\nasync function drawFromTable(tableName) {\n\n  let list_compendium = await game.packs.filter(p=>p.documentName=='RollTable');      \n  let inside = await list_compendium.find( p=>p.metadata.label=='RPG Next - Tabelas' ).getDocuments();      \n  const table = await inside.filter( p=>p.name==tableName )[0];          \n  \n  if (!table) {\n    ui.notifications.warn(`Table ${tableName} not found.`, {});\n    return;\n  }\n  const output = await table.roll();\n  const result = output.results[0].img;\n  await ChatMessage.create({content: `<img src=\"${result}\">`});\n  \n  const popout = new ImagePopout(result).render(true);\n  popout.shareImage();\n}","folder":null,"sort":0,"flags":{"core":{"sourceId":"Macro.O6viqS0xzNwe5APo"}},"_id":"vQpQ3TRiQ3Zo14Jv","ownership":{"default":0,"Ol2t8tYZADY5EZKq":3},"_stats":{"systemId":"dnd5e","systemVersion":"2.0.0-alpha3","coreVersion":"10.279","createdTime":null,"modifiedTime":1661792610583,"lastModifiedBy":"RIvpcrnNsACOddfy"}}
